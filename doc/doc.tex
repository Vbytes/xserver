%!TEX encoding = UTF-8 Unicode %

\documentclass[a4paper,cs4size,oneside,cap]{ctexrep}

\usepackage{amsmath,amssymb,amsfonts,amsthm,epsfig,bm,xspace,latexsym}
\usepackage{enumitem}
\usepackage{fix-cm}
\usepackage{makecell}
\usepackage[bottom]{footmisc}
\usepackage{geometry}
\usepackage{longtable}
\usepackage{array}
\usepackage{fancyhdr}
\usepackage{lastpage}
\usepackage{graphicx}
\usepackage{mathrsfs}
\usepackage{indentfirst}
\usepackage{titlesec}
\usepackage{multirow,tabularx}
\usepackage{hyperref}
\usepackage{listings,xcolor,color}
\usepackage{dirtree}
\usepackage{bbding,tikz}
\usetikzlibrary{positioning,patterns,calc,chains,scopes}
\usetikzlibrary{shapes,decorations,shadows,arrows,fadings}
\usetikzlibrary{automata,backgrounds,petri,decorations.pathreplacing}

\hypersetup{
    bookmarksnumbered,bookmarksopen,
    colorlinks,
    linkcolor=red,
    citecolor=green,
    urlcolor=blue,
    filecolor=magenta
}

\CTEXoptions[today=small]

\setmainfont{Times New Roman}

\geometry{left=2cm,right=2cm,top=2cm,bottom=2cm}
\geometry{includehead,headheight=15pt,headsep=25pt}

\fancypagestyle{plain}{%
    \fancyhf{}
    \renewcommand{\headrule}{}
    \renewcommand{\footrulewidth}{0pt}
}

\pagestyle{fancy}

\newcommand{\makeheadrule}{
    \makebox[0pt][l]{\rule[0.7\baselineskip]{\headwidth}{0.8pt}}%
    \rule[0.6\baselineskip]{\headwidth}{0.4pt}\vskip-0.8\baselineskip}
\makeatletter

\renewcommand{\headrule}{
    {\if@fancyplain\let\headrulewidth\plainheadrulewidth\fi%
     \makeheadrule}
}
\makeatother

\renewcommand{\footrulewidth}{0.5pt}

\fancyhf{}
\fancyhead[L]{\leftmark}
\fancyhead[R]{\rightmark}
\fancyfoot[R]{Page \thepage{} of \protect\pageref*{LastPage}}

\makeatletter
\def\printtitle{%
    {\centering\@title}}
\makeatother

\makeatletter
\def\printauthor{%
    {\centering\large\@author}}
\makeatother

\title{\fontsize{50}{50}\selectfont%
    \vspace*{2cm}%
    \hfil xserver 使用说明%
    \vspace*{2cm}%
}

\author{
    \hfill by spinlock9 \\
    \hfill \\
    \hfill \today \\
}

\graphicspath{{figures/}}

\renewcommand{\contentsname}{\Huge{}目\hspace{1em}录}
\renewcommand{\listfigurename}{\Huge{}插图索引}
\renewcommand{\listtablename}{\Huge{}表格索引}
\renewcommand{\figurename}{图}
\renewcommand{\tablename}{表}

\titleformat{\chapter}[hang]{\huge\bfseries}%
    {\CTEXnumber{\thezhchapter}{\thechapter}%
        \raggedright{}第\hspace{0.25em}\thezhchapter\hspace{0.25em}章：}{0.3em}{}

\titleformat{\section}[hang]{\LARGE\bfseries}%
    {\raggedright\thesection}{0.2em}{}

\titleformat{\subsection}[hang]{\Large\bfseries}%
    {\raggedright\thesubsection}{0.2em}{}

\titleformat{\subsubsection}[hang]{\large\bfseries}%
    {\raggedright\thesubsubsection}{0.2em}{}

\makeatletter
\renewcommand\chapter{\par%
  \thispagestyle{plain}%
  \global\@topnum\z@
  \@afterindentfalse
  \secdef\@chapter\@schapter}
\makeatother

\renewcommand{\chaptermark}[1]{\markboth{\bfseries{#1}}{}}

\newcommand{\newchap}[1]{\include{chaps/#1} \clearpage}

\setlist{noitemsep}
\setenumerate{topsep=0pt,labelindent=\parindent,%
    leftmargin=4em,rightmargin=2em,listparindent=\parindent}

\setitemize{topsep=0pt,labelindent=\parindent,%
    leftmargin=4em,rightmargin=2em,listparindent=\parindent}

\newcommand{\cndash}{\rule{0.0em}{0pt}\rule[0.35em]{1.6em}{0.05em}\rule{0.2em}{0pt}}

\lstset{
    basicstyle=\ttfamily\footnotesize,
    identifierstyle=\ttfamily\footnotesize,
    keywordstyle=\color[RGB]{0,170,0},
    commentstyle=\color[RGB]{0,0,139},
    stringstyle=\color[RGB]{235,0,0},
    showspaces=false,
    showstringspaces=true,
    tabsize=4,
    rulesepcolor=\color[RGB]{190,190,190},
    escapeinside=``,
    xleftmargin=1.5em,
    xrightmargin=1.5em,
    aboveskip=1em,
    lineskip=0pt,
    breaklines,
    extendedchars=false,
    firstnumber=1,
    stepnumber=1
}

%\lstnewenvironment{bashcode0}{\lstset{language={bash},%
%    aboveskip=0pt,%
%    frame=none,%
%    lineskip=-0.05em,%
%    xleftmargin=0.6em,%
%    xrightmargin=0.6em,%
%    basewidth={0.45em,0.35em},%
%    showstringspaces=false,%
%    commentstyle=\color{black},%
%    keywordstyle=\color{black}}
%}{}

\lstnewenvironment{bashcode}{\lstset{language={bash},
    frameround=tftt,frame=tlBR,framerule=0.3pt,
    showstringspaces=false,
    escapeinside=``,
    stringstyle=\color{black},
    commentstyle=\color{black},
    keywordstyle=\color{black}}
}{}

\lstnewenvironment{javacode}{\lstset{language={java},
    frameround=tftt,frame=tlBR,framerule=0.3pt,
    showstringspaces=false,
    escapeinside=``,
    stringstyle=\color{black},
    commentstyle=\color{black},
    keywordstyle=\color{black}}
}{}

\newcolumntype{I}{!{\vrule width 3pt}}
\newlength\savedwidth
\newcommand\whline{\noalign{\global\savedwidth\arrayrulewidth
    \global\arrayrulewidth 3pt}%
    \hline
    \noalign{\global\arrayrulewidth\savedwidth}}
\newlength\savewidth
\newcommand\shline{\noalign{\global\savewidth\arrayrulewidth
    \global\arrayrulewidth 1.5pt}%
    \hline
    \noalign{\global\arrayrulewidth\savewidth}}

\usepackage{booktabs}

\begin{document}

\setlength{\parindent}{2em}
\setlength{\baselineskip}{1.4em}
\setlength{\parskip}{1ex}

\thispagestyle{empty}

\begin{center}
    \definecolor{Grey}{RGB}{190,190,190}
    \colorbox{Grey} {
        \parbox[t]{\textwidth}{
            \printtitle
        }
    }
\end{center}

\vspace*{0.4\textheight}
\printauthor
\hfill\rule{0.24\linewidth}{0.6pt}
\clearpage

\tableofcontents
\clearpage

\setcounter{page}{1}

\newchap{chap1}
\newchap{chap2}
\newchap{chap3}

\makeatletter
\listoftables
\listoffigures
\makeatother

\end{document}

